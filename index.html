<!DOCTYPE html>
<html>
<head>
    <title>Hotspotter Plotter</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #map {
            height: 100%;
        }
    </style>
</head>
<body>
<div id="map"></div>
<script>
    var map;
    function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
            center: {lat: -34.397, lng: 150.644},
            zoom: 16
        });
        // Try HTML5 geolocation.
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function (position) {
                var pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };

                map.setCenter(pos);
            }, function (event) {
                console.log('Could not locate user: ' + event.message);
            });
        } else {
            console.log('Could not locate user: Not supported in browser');
        }
        loadPoints(function(points) {
            var i = 0;
            for (var key in points) {
                var point = points[key];
                if (!isCommonSSID(point.ssid)) {
                    var marker = new google.maps.Marker({
                        position: { lat: point.position.lat, lng: point.position.lon },
                        map: map,
                        title: point.ssid
                    });
                }
                i++;
            }
            console.log(i);
        });
    }
    function loadPoints(callback) {
        var ajax = new XMLHttpRequest();
        ajax.addEventListener("load", reqListener);
        ajax.open("GET", "/store.json");
        ajax.send();
        function reqListener(event) {
            data = event.target.responseText;
            var points = JSON.parse(data);
            callback(points);
        }
    }

function isCommonSSID(ssid) {
    var common = ['BT', 'SKY', 'VM', 'TALKTALK', 'DIRECT', 'virgin', 'TP-LINK', 'PLUSNET'];
    for (var i in common) {
        var item = common[i];
        if (ssid.indexOf(item) !==  -1) {
            return true;
        }
    }
    return false;
}
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBbXz4K5z1iLZDyZMSpjOkuvjENr1Rze3w&callback=initMap"
        async defer></script>
</body>
</html>
